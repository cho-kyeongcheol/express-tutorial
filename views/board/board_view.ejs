<!DOCTYPE html>
<html>
<%- include('../common/head') -%>

    <body>
        <h1>View</h1>

        <div class="container w100">
            <% if (user) { %>
                <div class="title">
                    작성자명
                </div>
                <div id="username">
                    <%= user.username %>
                </div>
                <% } %>

                    <div class="col mt-20">
                        <span>board_no</span> <br>
                        <span id="bbs_eq"><%= todo.bbs_eq %></span>

                    </div>


                    <div class="col mt-20">
                        <span>Title</span>
                        <input id="inputTitle" type='text' class='form-control input300' value="<%= todo.title %>">
                    </div>

                    <div class="row mt-20">
                        <div class="col">
                            <span>Content</span>
                            <textarea id="inputText" type='text' class='form-control input600'>
                                <%= todo.content %>
                            </textarea>                            
                        </div>
                        <div class="col">
                            <span>board_type</span><br>
                            <select class="custom-select" name="pets" id="board_select">
                                <option value="news">news</option>
                                <option value="Gallery">Gallery</option>
                                <option value="Q&A">Q&A</option>
                            </select>
                        </div>

                        <div class="mb-3" id="imageload">   
                        </div>

                        <div class="mb-3 mt-20">
                            <div class="col"></div>
                            <form action="/upload" method="post" enctype="multipart/form-data" id="fileForm">
                                <input type="file" id="fileInput" name="fileInput">
                            </form>
                            <input type="text" id="filePath"> 
                            <button class="btn btn-primary" onclick="updateTodo()">수정</button>
                            <button class="btn btn-secondary" onclick="deleteTodo(${el.bbs_eq})">삭제</button>
                            <button class="btn btn-primary w200" onclick="goIndex()">홈페이지로이동</button>
                        </div>
                    </div>

                    <hr>
                <div class="col mt-20">
                <h2>Reply</h2>>

                <table class="todo_list2">
                    <tr>                                            
                      <th>user_id</th>
                      <th class="content">content</th>                      
                    </tr>
                    <tr>                        
                        <td>21452313</td>
                        <td>댓글댓글댓글댓글댓글</td>
                    </tr>
                
                  </table>

                    <<h5>댓글작성</h5>
                    <input id="replyTitle" type='text' class='form-control' placeholder="제목을 입력하세요.">
                    <input id="replyContent" type='text' class='form-control' placeholder="내용을 입력하세요.">
    
                </div>
                <button class="btn btn-primary" onclick="insertReply()">댓글등록</button>



        </div>

        
     


        <%- include('../common/javascript') -%>

            <script>

            function readTodo() {
                    $.post("/api/vi/reply/read/", {
                        // pass
                    }).done(function (data) {
                        var todos = data.data;
                        console.log('todos = ', todos);
                        todos.forEach(el => {
                        const content = `                      
                    <tr>
                        <td>              
                        ${el.user_eq}
                        </td>       
                        <td>              
                        ${el.content}
                        </td>
                        <td>
                        ${el.board_type}
                        </td>
                        <td>
                        ${el.count}
                        </td>           
                    </tr>
                    
                    `
                        $('#todo_list').append(content);
                        });

                    })
                    }





                function insertReply() {
                    var replyTitle = $('#replyTitle').val();
                    var replyContent = $('#replyContent').val();
                    var bbs_eq = $("#bbs_eq").html();
                    console.log('replyTitle => ',replyTitle)
                    console.log('replyContent => ',replyContent)
                    $.post("/api/vi/reply/insert" ,{  
                        replyTitle:replyTitle,
                        replyContent:replyContent
                    }).done(function (data) {
                        if (data.result === 'fail') {
                           console.log('댓글실패')
                        } else {
                            console.log('댓글성공')
                        }
                    })     
                }

            readUpload()

                
                function readUpload() {      
                $.post("/api/vi/upload/board/read/", {
                        // pass
                    }).done(function (data) {
                        var post_file = data.data;
                        const content = `
                        <% if(img_src != undefined) { %>
                        <img src="<%= src %>" style="width: 200px; height: 300px;"/>
                        <% }  %>

                        <% if(img_src == undefined) { %>
                            <div>이미지를 선택하세요</div>
                        <% }  %>
                        `
                        $('#imageload').prepend(content);
                    })         
                }
                
                function updateTodo() {
                    var bbs_eq = $("#bbs_eq").html();
                    var inputTitle = $('#inputTitle').val();
                    var inputText = $('#inputText').val();
                    var board_select = $('#board_select').val();   
                    console.log("bbs_eq => ", bbs_eq)
                    console.log("inputTitle => ", inputTitle)
                    console.log("inputText => ", inputText)
                    console.log("board_select => ", board_select)
                    $.post("/api/vi/board/update/", {  
                        bbs_eq:bbs_eq,                      
                        inputTitle: inputTitle,
                        inputText: inputText,
                        board_select: board_select
                    }).done(function (data) {
                        if (data.result === 'fail') {
                            Swal.fire({
                                icon: 'error',
                                title: '수정',
                                text: '실패!'
                            })
                        } else {
                            Swal.fire({
                                icon: 'success',
                                title: '수정',
                                text: '성공!'
                            })
                        }
                    })                    
                }

                function goIndex() {
                    window.location.href = "/";
                }

                function insertTodo() {
                    var inputTitle = $('#inputTitle').val();
                    var inputText = $('#inputText').val();
                    var board_select = $('#board_select').val();
                    console.log("inputTitle =>", inputTitle)
                    console.log("inputText =>", inputText)
                    console.log("board_select =>", board_select)
                    $.post("/api/v1/board/insert", {
                        inputTitle: inputTitle,
                        inputText: inputText,
                        board_type: board_select
                    }).done(function (data) {
                        if (data.result === 'fail') {
                            Swal.fire({
                                icon: 'error',
                                title: '등록!',
                                text: '실패!'
                            })
                        } else {
                            // success
                            Swal.fire({
                                icon: 'success',
                                title: '등록!',
                                text: '성공!'
                            })

                        }
                    });
                }







            </script>
    </body>

</html>